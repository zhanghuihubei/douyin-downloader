# 抖音下载器限流配置

## 限流策略总览

为防止被抖音反爬虫检测，本工具实施了多层限流机制：

### 1. 下载队列控制 (background.js)
- **队列长度**: 无限制，可持续添加视频
- **下载间隔**: 20-30秒随机延迟
- **配置参数**:
  ```javascript
  minDelay: 20000,     // 最小延迟20秒
  maxDelay: 30000      // 最大延迟30秒
  ```
- **说明**: 队列会持续增长，下载一个后自动处理下一个，始终保持稳定的下载节奏

### 2. 用户视频获取限流 (content.js)
- **用户间隔**: 每个用户之间等待3-5秒
- **目的**: 避免短时间内大量请求用户主页

### 3. API分页请求限流 (injected.js)
- **关注列表分页**: 每页之间等待2-4秒
- **视频列表分页**: 每页之间等待2-4秒
- **目的**: 模拟人工操作，降低检测风险

## 时间消耗估算

假设下载50个视频，来自10个关注用户：

1. **获取关注列表**: ~5-10秒（取决于分页）
2. **获取用户视频**: 10个用户 × 4秒 ≈ 40秒
3. **下载视频**: 50个视频 × 25秒（平均） ≈ 20-22分钟
   - 队列会持续处理，一边下载一边可以继续添加新视频
4. **总计**: 约20-25分钟完成50个视频（取决于网络速度）

## 安全建议

✅ **推荐做法**:
- 保持默认的限流配置
- 避免在短时间内重复扫描
- 定期检查下载日志，确保无异常

❌ **不推荐**:
- 减少延迟时间到10秒以下（容易被检测）
- 移除所有延迟限制
- 24小时不间断高频运行

## 自定义配置

如需调整限流参数，修改 `background.js`:

```javascript
let config = {
  minDelay: 20000,   // 最小延迟：建议15-30秒
  maxDelay: 30000    // 最大延迟：建议25-45秒
};
```

修改 `content.js` 中的用户间隔:
```javascript
const delay = getRandomDelay(3000, 5000); // 建议3-8秒
```

修改 `injected.js` 中的API间隔:
```javascript
const delay = getRandomDelay(2000, 4000); // 建议2-5秒
```

## 日志说明

正常运行时，控制台会显示：

```
=== 开始处理下载队列 ===
📦 队列中有 50 个视频待下载
⏱️ 限流配置: 每个视频间隔 20 - 30 秒
正在下载: xxx 剩余: 49
✅ 下载成功！ID: 1690
⏱️ 等待 24.3 秒后继续下载...
```

如果看到：
- `✅ 添加视频: xxx` - 视频成功加入队列
- `跳过队列中已存在: xxx` - 防止重复添加
- `❌ 下载失败` - 可能需要检查网络或增加延迟

## 风险等级

| 配置 | 风险等级 | 说明 |
|------|---------|------|
| 默认配置(20-30秒) | 🟢 低 | 安全，推荐 |
| 减少50%延迟(10-15秒) | 🟡 中 | 有一定风险 |
| 延迟<10秒 | 🔴 高 | 极易被检测 |

---
**更新日期**: 2025-11-07  
**版本**: v1.1
